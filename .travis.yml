sudo: required

language: generic

services:
  - docker

env:
  global:
    - DISPLAY=:99.0
  matrix:
    - TAG=andremiras/etherollapp-linux DOCKERFILE=dockerfiles/Dockerfile-linux COMMAND='make test'
    - TAG=andremiras/etherollapp-linux DOCKERFILE=dockerfiles/Dockerfile-linux COMMAND='make uitest'
    - TAG=andremiras/etherollapp-android DOCKERFILE=dockerfiles/Dockerfile-android COMMAND='buildozer android debug'

install:
  - sudo apt update -qq > /dev/null
  - sudo apt install --yes --no-install-recommends xvfb

before_script:
  - sh -e /etc/init.d/xvfb start
  - docker pull $TAG
  - docker build --tag=$TAG --file=$DOCKERFILE --build-arg TRAVIS .

script:
  - travis_wait 30 docker run -e DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix $TAG $COMMAND
